<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatib le" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
        <!-- 导入 layui 的样式表 -->
        <link rel="stylesheet" type="text/css" href="http://10.168.0.218:8086/rsp-group-innovation/static/css/common.css" />
        <link rel="stylesheet" type="text/css" href="http://10.168.0.218:8086/rsp-group-innovation/static/lib/layui/css/layui.css" />
        <!-- 导入自己的样式表 -->
        <link rel="stylesheet" href="./css/runnet_common.css" />
        <link rel="stylesheet" href="./css/runnet_page.css" />
        <title>作品审核</title>
        <style>
            .review_form .layui-form-label {
                width: 100px;
            }
        </style>
    </head>

    <body>
        <div id="headDiv"></div>
        <div id="searchDiv"></div>

        <div class="runnet_main_body">
            <div class="wrap">
                <div class="runnut_head">
                    <span class="borderl"></span>
                    <span class="layui-breadcrumb" lay-separator=">">
                        <a href="mySpaceDashboard.html">个人信息</a>
                        <a><cite id="curTitle">作品审核</cite></a>
                    </span>
                </div>
                <div class="m-t-md">
                    <div class="layui-inline">活动简称</div>
                    <div class="layui-inline"><input type="text" name="shortName" class="layui-input" /></div>
                </div>
                <table class="layui-hide" id="work_table" lay-filter="work_table"></table>
                <div class="border-top m-t-lg m-b-lg"></div>
                <form class="review_form layui-form" action lay-filter="review_form">
                    <div class="layui-form-item">
                        <label class="layui-form-label">审核结果</label>
                        <div class="layui-input-block">
                            <select name="firstReviewState" lay-filter="firstReviewState">
                                <option value="1">通过</option>
                                <option value="2">不通过</option>
                                <option value="3">修改</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">审核意见</label>
                        <div class="layui-input-block">
                            <textarea name="firstOpinion" lay-verify="" placeholder="" class="layui-textarea"></textarea>
                        </div>
                    </div>
                    <div class="layui-form-item m-t-lg p-l-md text-center">
                        <div class="layui-input-block">
                            <a lay-submit class="layui-btn" lay-filter="submit_form">提交</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </body>
</html>
<script type="text/javascript" src="http://10.168.0.218:8086/rsp-group-innovation/static/lib/jquery.js"></script>
<script type="text/javascript" src="http://10.168.0.218:8086/rsp-group-innovation/static/js/common.js"></script>
<script type="text/javascript" src="http://10.168.0.218:8086/rsp-group-innovation/static/lib/layui/layui.all.js"></script>
<script src="js/base.js"></script>
<script>
    var userId = sessionStorage.getItem('token')
    var activityDataGrid = [],
        notifyDetail = {},
        awardSetting = [],
        noticeId = JSON.parse(sessionStorage.getItem('findWorkByWorkType')).noticeId

    $('#my_space_nav').load('templates/my_space_nav.html')

    layui.use(['table', 'form'], function () {
        var table = layui.table,
            form = layui.form

        $.get(baseUrl + '/notice/detail?noticeId=' + noticeId, function (res) {
            if (res.code === 200) {
                notifyDetail = res.data
                $('input[name="shortName"]').val(notifyDetail.shortName)
                $.get(baseUrl + '/works/findList?noticeId=' + noticeId, function (workRes) {
                    if (workRes.code === 200) {
                        activityDataGrid = workRes.data
                        renderTable()
                    }
                })
            }
        })
        renderTable = function () {
            awardSetting = JSON.parse(notifyDetail.awardSetting) || []
            var optionEl = ''
            for (var i = 0; i < awardSetting.length; i++) {
                optionEl += '<option value="' + awardSetting[i].level + '">' + awardSetting[i].level + '</option>'
            }
            table.render({
                elem: '#work_table',
                data: activityDataGrid,
                cols: [
                    [
                        { type: 'numbers' },
                        { field: 'worksType', title: '作品类型' },
                        { field: 'author', title: '作者' },
                        { field: '', title: '单位' },
                        { field: '', title: '职务' },
                        { field: 'score', title: '得分/得票数' },
                        {
                            field: 'score',
                            title: '奖项',
                            templet: function (d) {
                                console.log(d)
                                var el =
                                    ' <form class="review_form layui-form" action lay-filter="review_form">' +
                                    '<select name="" id="' +
                                    d.id +
                                    '">' +
                                    optionEl +
                                    '</select>' +
                                    '</form>'
                                return el
                            },
                        },
                    ],
                ],
                done: function (obj) {
                    $('.layui-table-body, .layui-table-box, .layui-table-cell').css('overflow', 'visible')
                    // $('.layui-table-body, .layui-table-cell,td[data-field="score"]  ').css('overflow', 'visible')

                    var cells = document.querySelectorAll('div[lay-id="work_table"] .layui-table-cell')
                    for (var i = 0; i < cells.length; i++) {
                        cells[i].style.height = 'auto'
                    }
                },
            })
        }

        form.on('submit(submit_form)', function (obj) {
            var formData = obj.field
            if (Number(formData.state) !== 1) {
                return layer.msg('请输入审核理由')
            }
        })
    })
</script>
