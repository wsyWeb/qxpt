<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatib le" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
        <link rel="stylesheet" type="text/css" href="http://10.168.0.218:8086/rsp-group-innovation/static/css/common.css" />

        <link rel="stylesheet" href="./lib/layui/css/layui.css" />
        <link rel="stylesheet" href="./css/runnet_common.css" />
        <link rel="stylesheet" href="./css/runnet_page.css" />
        <title>专家领域设置</title>
        <style>
            #treeWrap .layui-colla-title .layui-btn-group {
                position: absolute;
                right: 15px;
                top: 0;
            }
            #treeWrap .item {
                border: 1px solid #c9c9c9;
                padding: 5px 0 5px 10px;
            }
            #treeWrap .item .layui-btn {
                border-color: transparent;
            }
            #treeWrap .item .layui-btn {
                border-left: 1px solid #c9c9c9;
            }
            .register_expert_form .layui-form-label {
                text-align: center;
                width: 120px;
                color: #999999;
            }
            .register_expert_form .layui-input-block {
                border-left: 1px solid #dedede;
                margin-left: 150px;
            }
            .register_expert_form .basic-info .layui-form-item {
                margin: 0;
                border-bottom: 1px solid #dedede;
            }
            .register_expert_form .layui-col-md6:nth-child(2n) {
                border-left: 1px solid #dedede;
            }
            .register_expert_form .layui-col-md6 {
                border-bottom: 1px solid #dedede;
            }
            .register_expert_form .achievement .layui-input {
                width: 90%;
            }
            .register_expert_form .achievement .del-btn {
                cursor: pointer;
                position: absolute;
                right: 0;
                top: 15px;
            }
            .register_expert_form .layui-form-item[disable='1'] {
                border-top: 1px dotted #c9c9c9;
                padding-top: 20px;
            }
            .register_expert_form .layui-form-item[disable='1'] .del-btn {
                display: none;
            }
        </style>
    </head>

    <body>
        <div id="headDiv"></div>
        <div id="searchDiv"></div>

        <div class="runnet_main_body">
            <div class="wrap p-t-lg overflow-hidden" id="expertFormSetting">
                <div id="my_space_nav" class="m-r-md float-left" style="width: 180px"></div>
                <div id="my_space_content" class="float-left" style="width: 1000px">
                    <div class="m-b-md">
                        <span class="font-15 font-bold">领域设置</span>
                        <a onclick="addFun(this, 1)" class="layui-btn layui-btn-sm">新增</a>
                    </div>
                    <!-- <ul id="tree-wrap"></ul> -->
                    <div class="layui-collapse" id="treeWrap"></div>
                    <script id="tree" type="text/html">
                        {{# layui.each(d, function(idx1, item){ }}
                        <div class="layui-colla-item">
                            <h2 class="layui-colla-title">
                                {{item.title}}
                                <div class="layui-btn-group">
                                    <button type="button" class="layui-btn layui-btn-primary layui-btn-xs" id="{{item.id}}" onclick="addFun(this)">
                                        <i class="layui-icon">&#xe654;</i>
                                    </button>
                                    <button
                                        type="button"
                                        class="layui-btn layui-btn-primary layui-btn-xs"
                                        name="{{item.title}}"
                                        id="{{item.id}}"
                                        onclick="updateFun(this)"
                                    >
                                        <i class="layui-icon">&#xe642;</i>
                                    </button>
                                    <button type="button" class="layui-btn layui-btn-primary layui-btn-xs" id="{{item.id}}" onclick="deleteFun(this)">
                                        <i class="layui-icon">&#xe640;</i>
                                    </button>
                                </div>
                            </h2>
                            <div class="layui-colla-content">
                                {{# layui.each(item.children, function(idx2, work){ }}
                                <div class="layui-inline item relative">
                                    <span>{{work.title}}</span>
                                    <div class="layui-btn-group">
                                        <button
                                            type="button"
                                            class="layui-btn layui-btn-primary layui-btn-xs"
                                            name="{{work.title}}"
                                            id="{{work.id}}"
                                            onclick="updateFun(this)"
                                        >
                                            <i class="layui-icon">&#xe642;</i>
                                        </button>
                                        <button
                                            type="button"
                                            class="layui-btn layui-btn-primary layui-btn-xs"
                                            id="{{work.id}}"
                                            onclick="deleteFun(this)"
                                        >
                                            <i class="layui-icon">&#xe640;</i>
                                        </button>
                                    </div>
                                </div>
                                {{# }); }}
                            </div>
                        </div>

                        {{# }); }}
                    </script>
                    <div class="font-15 font-bold m-t-lg">表单设置</div>
                    <div class="m-t-sm">基本信息</div>
                    <div id="expert_form" class="m-t-lg">
                        <form class="layui-form m-t-md register_expert_form" action="" lay-filter="register_expert_form">
                            <div class="border basic-info">
                                <div class="layui-form-item">
                                    <div class="p-xs">
                                        <img id="headPortrait-img" width="100px" height="120px" />
                                    </div>
                                </div>
                                <div class="layui-row">
                                    <div class="layui-col-md6">
                                        <label class="layui-form-label">姓名</label>
                                        <div class="layui-input-block"></div>
                                    </div>
                                    <div class="layui-col-md6">
                                        <label class="layui-form-label">性别</label>
                                        <div class="layui-input-block"></div>
                                    </div>
                                    <div class="layui-col-md6">
                                        <label class="layui-form-label">出生日期</label>
                                        <div class="layui-input-block"></div>
                                    </div>
                                    <div class="layui-col-md6">
                                        <label class="layui-form-label">政治面貌</label>
                                        <div class="layui-input-block"></div>
                                    </div>

                                    <div class="layui-col-md6">
                                        <label class="layui-form-label">工作单位</label>
                                        <div class="layui-input-block"></div>
                                    </div>
                                    <div class="layui-col-md6">
                                        <label class="layui-form-label">参工时间</label>
                                        <div class="layui-input-block"></div>
                                    </div>
                                    <div class="layui-col-md6">
                                        <label class="layui-form-label">岗位级别</label>
                                        <div class="layui-input-block"></div>
                                    </div>
                                    <div class="layui-col-md6">
                                        <label class="layui-form-label">从事专业</label>
                                        <div class="layui-input-block"></div>
                                    </div>

                                    <div class="layui-col-md6">
                                        <label class="layui-form-label">职称</label>
                                        <div class="layui-input-block"></div>
                                    </div>
                                    <div class="layui-col-md6">
                                        <label class="layui-form-label">职务</label>
                                        <div class="layui-input-block"></div>
                                    </div>
                                    <div class="layui-col-md6">
                                        <label class="layui-form-label">毕业学校</label>
                                        <div class="layui-input-block"></div>
                                    </div>
                                    <div class="layui-col-md6">
                                        <label class="layui-form-label">最高学历</label>
                                        <div class="layui-input-block"></div>
                                    </div>
                                    <div class="layui-col-md6">
                                        <label class="layui-form-label">电子邮箱</label>
                                        <div class="layui-input-block"></div>
                                    </div>
                                    <div class="layui-col-md6">
                                        <label class="layui-form-label">手机号</label>
                                        <div class="layui-input-block"></div>
                                    </div>
                                    <div class="layui-col-md6">
                                        <label class="layui-form-label">通讯地址</label>
                                        <div class="layui-input-block"></div>
                                    </div>
                                    <div class="layui-col-md6">
                                        <label class="layui-form-label">入驻领域</label>
                                        <div class="layui-input-block"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="m-b-md m-t-md">
                                其它说明
                                <i class="layui-icon-add-circle layui-icon font-18 cursor-pointer" onclick="addNode()"></i>
                            </div>
                            <div class="achievement">
                                <div class="defaultExpertParams"></div>
                                <div class="layui-form-item">
                                    <a class="layui-btn layui-btn-primary" id="upload_attachment_btn">上传打扫件</a>
                                </div>
                            </div>
                            <div class="text-center"><a class="layui-btn layui-btn save-btn" lay-submit lay-filter="save_form">保存</a></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
<script src="lib/layui/layui.all.js"></script>
<script src="lib/jquery.js"></script>
<script src="js/base.js"></script>

<script type="text/javascript" src="http://10.168.0.218:8086/rsp-group-innovation/static/js/common.js"></script>

<script>
    $('#my_space_nav').load('templates/my_space_nav.html')

    var treeLists = [],
        resExpertParams = [],
        renderTree
    layui.use(['laytpl', 'element', 'form'], function () {
        var laytpl = layui.laytpl,
            element = layui.element,
            form = layui.form
        var tpl = tree.innerHTML
        var view = document.getElementById('treeWrap')
        renderTree = function () {
            $.get(baseUrl + '/entryField/queryEntryFieldList', function (res) {
                if (res.code === 200) {
                    laytpl(tpl).render(res.data, function (html) {
                        view.innerHTML = html
                    })
                    element.render()
                }
            })
        }
        renderTree()
        $.get(baseUrl + '/template/queryTemplateList', function (res) {
            if (res.code === 200) {
                resExpertParams = res.data.dataArr
                setNode()
            }
        })
        form.on('submit(save_form)', function (obj) {
            var submitData = []
            var els = $('.defaultExpertParams').find('.layui-form-item') || []
            for (var o = 0; o < els.length; o++) {
                submitData.push({
                    id: $(els[o]).attr('id'),
                    disable: $(els[o]).attr('disable'),
                    title: $(els[o]).find('.title').val().replaceAll(' ', ''),
                    value: '',
                })
            }
            $.ajax({
                type: 'post',
                url: baseUrl + '/template/saveTemplateConfig',
                contentType: 'application/json;charset=UTF-8',
                data: JSON.stringify(submitData),
                success: function (res) {
                    if (res.code == 200) {
                        layer.msg('保存成功')
                    }
                },
            })
        })
    })
    function deleteFun(target) {
        layer.confirm(
            '你确定要删除吗？',
            {
                title: '提示',
            },
            function () {
                $.get(baseUrl + '/entryField/delentryField?id=' + $(target).attr('id'), function (res) {
                    if (res.code == 200) {
                        renderTree()
                        layer.msg('删除成功')
                    } else {
                        layer.msg(res.message)
                    }
                })
            }
        )
    }
    function updateFun(target) {
        layer.prompt(
            {
                title: '编辑',
                value: $(target).attr('name'),
            },
            function (val, index) {
                if (!val) return false
                var submitForm = {
                    id: $(target).attr('id'),
                    title: val,
                }
                $.ajax({
                    type: 'post',
                    url: baseUrl + '/entryField/updateEntryFieldById',
                    contentType: 'application/json;charset=UTF-8',
                    data: JSON.stringify(submitForm),
                    success: function (res) {
                        if (res.code == 200) {
                            renderTree()
                            layer.close(index)
                            layer.msg('修改成功')
                        } else {
                            layer.msg(res.message)
                        }
                    },
                })
            }
        )
    }
    function addFun(target, level) {
        layer.prompt(
            {
                title: '新增',
                value: '',
            },
            function (val, index) {
                if (!val) return false
                var submitForm = {
                    parentId: level == 1 ? '' : $(target).attr('id'),
                    title: val,
                }
                $.ajax({
                    type: 'post',
                    url: baseUrl + '/entryField/saveentryField',
                    contentType: 'application/json;charset=UTF-8',
                    data: JSON.stringify(submitForm),
                    success: function (res) {
                        if (res.code == 200) {
                            renderTree()
                            layer.close(index)
                            layer.msg('新增成功')
                        } else {
                            layer.msg(res.message)
                        }
                    },
                })
            }
        )
    }
    function setNode() {
        for (var i = 0; i < resExpertParams.length; i++) {
            $('.defaultExpertParams').append(
                '<div class="layui-form-item relative" id="' +
                    resExpertParams[i].id +
                    '" disable="' +
                    resExpertParams[i].disable +
                    '">' +
                    '<input class="layui-input title" lay-verify="required" value="' +
                    resExpertParams[i].title +
                    '"/>' +
                    '<i class="layui-icon layui-icon-reduce-circle del-btn" onclick="removeNode(this)"></i>' +
                    '</div>'
            )
        }
        $('input[name="workUnit"]').val('xxx')
    }
    function addNode() {
        $('.defaultExpertParams').prepend(
            '<div class="layui-form-item relative">' +
                '<input class="layui-input title" lay-verify="required" placeholder="请输入节点名称"/>' +
                '<i class="layui-icon layui-icon-reduce-circle  del-btn" onclick="removeNode(this)"></i>' +
                '</div>'
        )
    }
    function removeNode(target) {
        $(target).parent().remove()
    }
</script>
