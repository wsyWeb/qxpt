<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatib le" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
        <link rel="stylesheet" type="text/css" href="/rsp-group-innovation/static/lib/layui/css/layui.css" />
        <link rel="stylesheet" type="text/css" href="/rsp-group-innovation/static/css/common.css"/>
        <link rel="stylesheet" href="./css/runnet_common.css" />
        <link rel="stylesheet" href="./css/runnet_page.css" />
        <link rel="stylesheet" href="css/font/iconfont.css" />
        <title>专家领域设置</title>
        <style>
            #treeWrap .layui-btn-group {
                position: absolute;
                right: 15px;
                top: 0;
            }
            .add-tree-node {
                line-height: 38px;
                border: 1px dashed #2a6be3;
                color: #2a6be3;
                cursor: pointer;
                text-align: center;
            }
            #treeWrap .layui-btn-group .layui-btn {
                background-color: transparent !important;
                color: #2a6be3;
            }
            #treeWrap .layui-btn-group .layui-btn.del {
                color: #f04040;
            }
            #treeWrap .item {
                margin-bottom: 10px;
                padding-left: 20px;
            }
            #treeWrap .item .layui-btn {
                border-color: transparent;
            }
            #treeWrap .item .layui-btn-group {
                right: 0;
            }
            .basic-info .right .iconfont {
                font-size: 100px;
                color: #ddd;
                border: 1px solid #dedede;
                padding: 10px 0px;
            }
            .register_expert_form .layui-form-label {
                text-align: right;
                text-align-last: justify;
            }
            .register_expert_form .layui-input-block {
                margin-right: 20px;
                margin-left: 80px;
            }
            .defaultExpertParams .layui-icon-reduce-circle {
                position: absolute;
                right: 0;
                line-height: 36px;
                top: 0;
                border-left: 1px solid #dedede;
                width: 40px;
                text-align: center;
                color: #f04040;
                cursor: pointer;
            }
            .addExpertNodeWrap {
                line-height: 40px;
                border: 1px dashed #2a6be3;
                text-align: center;
                color: #2a6be3;
            }
        </style>
    </head>

    <body>
        <div id="headDiv"></div>
        <div id="searchDiv"></div>

        <div class="runnet_main_body">
            <div class="wrap p-t-lg overflow-hidden" id="expertFormSetting">
                <div id="my_space_nav" class="m-r-md float-left" style="width: 180px"></div>
                <div id="my_space_content" class="float-left p-md" style="width: 1000px">
                    <script id="tree" type="text/html">
                        {{# layui.each(d, function(idx1, item){ }}
                        <div class="layui-colla-item">
                            <h2 class="layui-colla-title">
                                {{item.title}}
                                <div class="layui-btn-group">
                                    <a class="layui-btn layui-btn-xs add" name="{{item.title}}" id="{{item.id}}" onclick="addFun(this)">新增</a>
                                    <a class="layui-btn layui-btn-xs" name="{{item.title}}" id="{{item.id}}" onclick="updateFun(this)">编辑</a>
                                    <a class="layui-btn layui-btn-xs del" name="{{item.title}}" id="{{item.id}}" onclick="deleteFun(this)">删除</a>
                                </div>
                            </h2>
                            <div class="layui-colla-content">
                                {{# layui.each(item.children, function(idx2, work){ }}
                                <div class="item relative">
                                    <span>{{work.title}}</span>
                                    <div class="layui-btn-group">
                                        <a class="layui-btn layui-btn-xs" name="{{work.title}}" id="{{work.id}}" onclick="updateFun(this)">编辑</a>
                                        <a class="layui-btn layui-btn-xs del" name="{{work.title}}" id="{{work.id}}" onclick="deleteFun(this)"
                                            >删除</a
                                        >
                                    </div>
                                </div>
                                {{# }); }}
                            </div>
                        </div>

                        {{# }); }}
                    </script>
                    <div id="expert_form" class="m-t-lg">
                        <form class="layui-form m-t-md register_expert_form" action="" lay-filter="register_expert_form">
                            <div class="m-t-lg m-b-sm font-15 font-bold color-theme tips-title relative">平台信息</div>
                            <div class="layui-row">
                                <label class="layui-form-label">入驻领域</label>
                                <div class="layui-input-block">
                                    <div class="add-tree-node" onclick="addFun(this, 1)"><i class="layui-icon-addition layui-icon"></i> 新增</div>
                                    <ul id="tree-wrap"></ul>
                                    <div class="layui-collapse" id="treeWrap"></div>
                                    <!-- <a class="layui-btn layui-btn-sm">设置</a> -->
                                </div>
                            </div>
                            <div class="m-t-lg m-b-sm font-15 font-bold color-theme tips-title">基本信息</div>
                            <div class="layui-row basic-info">
                                <div class="layui-col-md10 left">
                                    <div class="layui-col-md4 m-b-sm">
                                        <label class="layui-form-label">姓名</label>
                                        <div class="layui-input-block">
                                            <input type="text" readonly class="layui-input" />
                                        </div>
                                    </div>
                                    <div class="layui-col-md4 m-b-sm">
                                        <label class="layui-form-label">性别</label>
                                        <div class="layui-input-block">
                                            <input type="radio" name="gender" value="男" title="男" />
                                            <input type="radio" name="gender" value="女" title="女" />
                                        </div>
                                    </div>
                                    <div class="layui-col-md4 m-b-sm">
                                        <label class="layui-form-label">出生日期</label>
                                        <div class="layui-input-block">
                                            <input type="text" readonly class="layui-input" />
                                        </div>
                                    </div>
                                    <div class="layui-col-md4 m-b-sm">
                                        <label class="layui-form-label">政治面貌</label>
                                        <div class="layui-input-block">
                                            <input type="text" readonly class="layui-input" />
                                        </div>
                                    </div>

                                    <div class="layui-col-md4 m-b-sm">
                                        <label class="layui-form-label">工作单位</label>
                                        <div class="layui-input-block">
                                            <input type="text" readonly class="layui-input" />
                                        </div>
                                    </div>
                                    <div class="layui-col-md4 m-b-sm">
                                        <label class="layui-form-label">参工时间</label>
                                        <div class="layui-input-block">
                                            <input type="text" readonly class="layui-input" />
                                        </div>
                                    </div>
                                    <div class="layui-col-md4 m-b-sm">
                                        <label class="layui-form-label">岗位级别</label>
                                        <div class="layui-input-block">
                                            <input type="text" readonly class="layui-input" />
                                        </div>
                                    </div>
                                    <div class="layui-col-md4 m-b-sm">
                                        <label class="layui-form-label">从事专业</label>
                                        <div class="layui-input-block">
                                            <input type="text" readonly class="layui-input" />
                                        </div>
                                    </div>

                                    <div class="layui-col-md4 m-b-sm">
                                        <label class="layui-form-label">职称</label>
                                        <div class="layui-input-block">
                                            <input type="text" readonly class="layui-input" />
                                        </div>
                                    </div>
                                    <div class="layui-col-md4 m-b-sm">
                                        <label class="layui-form-label">职务</label>
                                        <div class="layui-input-block">
                                            <input type="text" readonly class="layui-input" />
                                        </div>
                                    </div>
                                    <div class="layui-col-md4 m-b-sm">
                                        <label class="layui-form-label">毕业学校</label>
                                        <div class="layui-input-block">
                                            <input type="text" readonly class="layui-input" />
                                        </div>
                                    </div>
                                    <div class="layui-col-md4 m-b-sm">
                                        <label class="layui-form-label">最高学历</label>
                                        <div class="layui-input-block">
                                            <input type="text" readonly class="layui-input" />
                                        </div>
                                    </div>
                                    <div class="layui-col-md4 m-b-sm">
                                        <label class="layui-form-label">电子邮箱</label>
                                        <div class="layui-input-block">
                                            <input type="text" readonly class="layui-input" />
                                        </div>
                                    </div>
                                    <div class="layui-col-md4 m-b-sm">
                                        <label class="layui-form-label">手机号</label>
                                        <div class="layui-input-block">
                                            <input type="text" readonly class="layui-input" />
                                        </div>
                                    </div>
                                    <div class="layui-col-md4 m-b-sm">
                                        <label class="layui-form-label">通讯地址</label>
                                        <div class="layui-input-block">
                                            <input type="text" readonly class="layui-input" />
                                        </div>
                                    </div>
                                </div>
                                <div class="layui-col-md2 right text-right">
                                    <i class="iconfont icon-morentouxiang"></i>
                                </div>
                            </div>
                            <div class="m-t-lg m-b-sm font-15 font-bold color-theme tips-title">个人经验</div>
                            <div class="defaultExpertParams"></div>
                            <div class="addExpertNodeWrap cursor-pointer" onclick="addNode()">
                                <i class="layui-icon-add-circle layui-icon"> 新增节点</i>
                            </div>
                            <div class="text-center m-t-lg"><a class="layui-btn layui-btn save-btn" lay-submit lay-filter="save_form">保存</a></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
<script type="text/javascript" src="/rsp-group-innovation/static/lib/jquery.js"></script>
<script type="text/javascript" src="/rsp-group-innovation/static/js/common.js"></script>
<script type="text/javascript" src="/rsp-group-innovation/static/lib/layui/layui.all.js"></script>
<script src="js/base.js"></script>
<script>
    $('#my_space_nav').load('templates/my_space_nav.html')

    // $('#treeWrap').on('click', '.add', function (e) {
    //     layui.stope(e)
    //     console.log('asjdsj ', e.target)
    // })
    var treeLists = [],
        resExpertParams = [],
        renderTree
    layui.use(['laytpl', 'element', 'form'], function () {
        var laytpl = layui.laytpl,
            element = layui.element,
            form = layui.form
        var tpl = tree.innerHTML
        var view = document.getElementById('treeWrap')

        renderTree = function () {
            $.get(baseUrl + '/entryField/queryEntryFieldList', function (res) {
                if (res.code === 200) {
                    laytpl(tpl).render(res.data, function (html) {
                        view.innerHTML = html
                    })
                    element.render()
                }
            })
        }
        renderTree()
        $.get(baseUrl + '/template/queryTemplateList', function (res) {
            if (res.code === 200) {
                resExpertParams = res.data.dataArr
                setNode()
            }
        })
        form.on('submit(save_form)', function (obj) {
            var submitData = []
            var els = $('.defaultExpertParams').find('.layui-form-item') || []
            for (var o = 0; o < els.length; o++) {
                submitData.push({
                    id: $(els[o]).attr('id'),
                    disable: $(els[o]).attr('disable'),
                    title: $(els[o]).find('.title').val().replaceAll(' ', ''),
                    value: '',
                })
            }
            $.ajax({
                type: 'post',
                url: baseUrl + '/template/saveTemplateConfig',
                contentType: 'application/json;charset=UTF-8',
                data: JSON.stringify(submitData),
                success: function (res) {
                    if (res.code == 200) {
                        layer.msg('保存成功')
                    }
                },
            })
        })
    })
    function deleteFun(target) {
        layer.confirm(
            '你确定要删除吗？',
            {
                title: '提示',
            },
            function () {
                $.get(baseUrl + '/entryField/delentryField?id=' + $(target).attr('id'), function (res) {
                    if (res.code == 200) {
                        renderTree()
                        layer.msg('删除成功')
                    } else {
                        layer.msg(res.message)
                    }
                })
            }
        )
    }
    function updateFun(target) {
        layer.prompt(
            {
                title: '编辑',
                value: $(target).attr('name'),
            },
            function (val, index) {
                if (!val) return false
                var submitForm = {
                    id: $(target).attr('id'),
                    title: val,
                }
                $.ajax({
                    type: 'post',
                    url: baseUrl + '/entryField/updateEntryFieldById',
                    contentType: 'application/json;charset=UTF-8',
                    data: JSON.stringify(submitForm),
                    success: function (res) {
                        if (res.code == 200) {
                            renderTree()
                            layer.close(index)
                            layer.msg('修改成功')
                        } else {
                            layer.msg(res.message)
                        }
                    },
                })
            }
        )
    }
    function addFun(target, level) {
        layer.prompt(
            {
                title: '新增',
                value: '',
            },
            function (val, index) {
                if (!val) return false
                var submitForm = {
                    parentId: level == 1 ? '' : $(target).attr('id'),
                    title: val,
                }
                $.ajax({
                    type: 'post',
                    url: baseUrl + '/entryField/saveentryField',
                    contentType: 'application/json;charset=UTF-8',
                    data: JSON.stringify(submitForm),
                    success: function (res) {
                        if (res.code == 200) {
                            renderTree()
                            layer.close(index)
                            layer.msg('新增成功')
                        } else {
                            layer.msg(res.message)
                        }
                    },
                })
            }
        )
    }
    function setNode() {
        var el = ''

        for (var i = 0; i < resExpertParams.length; i++) {
            var opt = ''
            if (Number(resExpertParams[i].disable) !== 1) {
                opt =
                    '<input class="layui-input title" lay-verify="required" value="' +
                    resExpertParams[i].title +
                    '"/>' +
                    '<i class="layui-icon layui-icon-reduce-circle del" onclick="removeNode(this)"></i>'
            } else {
                opt = '<input class="layui-input title" disabled lay-verify="required" value="' + resExpertParams[i].title + '"/>'
            }
            el +=
                '<div class="layui-form-item relative" id="' +
                resExpertParams[i].id +
                '" disable="' +
                resExpertParams[i].disable +
                '">' +
                opt +
                '</div>'
        }
        $('.defaultExpertParams').append(el)
    }
    function addNode() {
        $('.defaultExpertParams').append(
            '<div class="layui-form-item relative">' +
                '<input class="layui-input title" lay-verify="required" placeholder="请输入节点名称"/>' +
                '<i class="layui-icon layui-icon-reduce-circle  del" onclick="removeNode(this)"></i>' +
                '</div>'
        )
    }
    function removeNode(target) {
        $(target).parent().remove()
    }
</script>
